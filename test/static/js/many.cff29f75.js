(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["many"],{6685:function(e,t,o){},"81a9":function(e,t,o){"use strict";o.r(t);var n=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"room"},[o("div",{ref:"video-box",staticClass:"video-box"},[o("video",{ref:"video-mine",staticClass:"video-mine",attrs:{autoplay:"",controls:""}})])])},c=[],i=(o("d3b7"),{name:"home",data:function(){return{roomid:"",peer:null,peerList:{},candidate:null,localStream:null}},watch:{userList:{handler:function(){},deep:!0}},beforeDestroy:function(){for(var e in this.peerList)this.peerList[e].close(),this.peerList[e]=null},methods:{getUserMedia:function(){var e=this,t=this.$refs["video-mine"],o=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return new Promise((function(n,c){o.call(navigator,{audio:!0,video:!0},(function(o){t.srcObject=o,e.localStream=o,n()}),(function(e){c(e)}))}))},getPeerConnection:function(e){var t=this,o=this.$refs["video-box"],n={iceServers:[{url:"stun:stun.l.google.com:19302"}]},c=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,i=new c(n);i.addStream(this.localStream),i.onaddstream=function(t){var n=document.querySelector("#"+e.account);if(n)n.srcObject=t.stream;else{var c=document.createElement("video");c.controls=!0,c.autoplay="autoplay",c.srcObject=t.stream,c.id=e.account,o.append(c)}},i.onicecandidate=function(o){o.candidate&&socket.emit("__ice_candidate",{candidate:o.candidate,roomid:t.$route.params.roomid,account:e.account})},console.log("v.account",e.account),this.peerList[e.account]=i},createOffer:function(e,t){var o=this;t.createOffer({offerToReceiveAudio:1,offerToReceiveVideo:1}).then((function(n){t.setLocalDescription(n,(function(){socket.emit("offer",{sdp:t.localDescription,roomid:o.$route.params.roomid,account:e})}))}))},socketInit:function(){var e=this;socket.on("offer",(function(t){e.peerList[t.account]&&e.peerList[t.account].setRemoteDescription(t.sdp,(function(){e.peerList[t.account].createAnswer().then((function(o){e.peerList[t.account].setLocalDescription(o,(function(){socket.emit("answer",{sdp:e.peerList[t.account].localDescription,roomid:e.$route.params.roomid,account:t.account})}))}))}),(function(){}))})),socket.on("answer",(function(t){console.log("take_answer",t.sdp),e.peerList[t.account]&&e.peerList[t.account].setRemoteDescription(t.sdp,(function(){}),(function(){}))})),socket.on("__ice_candidate",(function(t){t.candidate&&e.peerList[t.account]&&e.peerList[t.account].addIceCandidate(t.candidate).catch((function(){}))})),socket.on("disconnected",(function(e){var t=document.querySelector("#"+e);t&&t.remove()}))}},mounted:function(){}}),a=i,r=(o("fe9c"),o("2877")),s=Object(r["a"])(a,n,c,!1,null,null,null);t["default"]=s.exports},fe9c:function(e,t,o){"use strict";o("6685")}}]);