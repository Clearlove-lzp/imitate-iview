!function(e){"use strict";var t=/MicroMessenger/i.test(navigator.userAgent),n=e.RecordAppBaseFolder||"/Recorder/src/",r=e.OnRecordAppInstalled,o=[{Key:"Native",Support:function(e){f.AlwaysAppUseJS?e(!1):s.Config.IsApp(e)},CanProcess:function(){return!0},Config:{IsApp:function(e){e(!1)},JsBridgeRequestPermission:function(e,t){t("JsBridgeRequestPermission未实现")},JsBridgeStart:function(e,t,n){n("JsBridgeStart未实现")},JsBridgeStop:function(e,t){t("JsBridgeStop未实现")},paths:[{url:n+"app-support/app-native-support.js",check:function(){return!s.IsInit}}]},ExtendDefault:!0},{Key:"IOS-Weixin",Support:function(e){f.AlwaysUseWeixinJS||!Recorder.Support()?a.Config.Enable((function(n){e(!!n&&t)})):e(!1)},CanProcess:function(){return!1},Config:{Enable:function(e){e(!0)},WxReady:function(e){e(null,"未实现IOS-Weixin.Config.WxReady")},DownWxMedia:function(e,t,n){n("下载素材接口DownWxMedia未实现")},paths:[{url:n+"app-support/app-ios-weixin-support.js",check:function(){return!a.IsInit}},{url:n+"engine/beta-amr.js",lazyBeforeStop:1,check:function(){return!Recorder.prototype.amr}},{url:n+"engine/beta-amr-engine.js",lazyBeforeStop:1,check:function(){return!Recorder.AMR}},{url:n+"engine/wav.js",lazyBeforeStop:1,check:function(){return!Recorder.prototype.wav}}]},ExtendDefault:!0},{Key:"Default",Support:function(e){e(!0)},CanProcess:function(){return!0},Config:{paths:[{url:n+"recorder-core.js",check:function(){return!e.Recorder}},{url:n+"engine/mp3.js",lazyBeforeStart:1,check:function(){return!Recorder.prototype.mp3}},{url:n+"engine/mp3-engine.js",lazyBeforeStart:1,check:function(){return!Recorder.lamejs}}]}}],s=o[0],a=o[1],u=o[2];u.RequestPermission=function(e,t){var n=f.__Rec;n&&(n.close(),f.__Rec=null),Recorder().open((function(){e()}),t)},u.Start=function(e,t,n){var r=f.__Rec;null!=r&&r.close(),f.__Rec=r=Recorder(e),r.appSet=e,r.open((function(){r.start(),t()}),(function(e){n(e)}))},u.Stop=function(e,t){var n=f.__Rec;if(!n)return Recorder.IsOpen()&&((n=Recorder()).open(),n.close()),void t("未开始录音");var r=function(){for(var e in n.close(),n.set)n.appSet[e]=n.set[e]},o=function(e){r(),t(e),f.__Rec=null};e?n.stop((function(t,o){r(),f._SRec=n,e(t,o),f.__Rec=null}),o):o("仅清理资源")};var i=function(t,n){var r=new Date,o=["["+("0"+r.getMinutes()).substr(-2)+":"+("0"+r.getSeconds()).substr(-2)+"."+("00"+r.getMilliseconds()).substr(-3)+" RecordApp]["+(f.Current&&f.Current.Key||"?")+"]"+t],s=arguments,a=e.console||{},u=2,i=a.log;for("number"==typeof n?i=1==n?a.error:3==n?a.warn:i:u=1;u<s.length;u++)o.push(s[u]);c?i&&i("[IsLoser]"+o[0],o.length>1?o:""):i.apply(a,o)},c=!0;try{c=!console.log.apply}catch(e){}var f={LM:"2022-03-03 18:58:07",Current:0,CLog:i,IsWx:t,BaseFolder:n,UseLazyLoad:!0,AlwaysUseWeixinJS:!1,AlwaysAppUseJS:!1,Platforms:{Native:s,Weixin:a,Default:u},Js:function(t,n,r,o){var s=(o=o||e).document,a=function(e){if(e>=t.length)n();else{var o=t[e],u=o.url;if(!1!==o.check()){var i=s.createElement("script");i.setAttribute("type","text/javascript"),i.setAttribute("src",u),i.onload=function(){a(e+1)},i.onerror=function(e){r("请求失败:"+(e.message||"-")+"，"+u)},s.body.appendChild(i)}else a(e+1)}};a(0)},Install:function(e,t){var n=f.__reqs||(f.__reqs=[]);n.push({s:e,f:t}),e=function(){r("s",arguments)},t=function(e,t){r("f",arguments)};var r=function(e,t){for(var r=0;r<n.length;r++)n[r][e].apply(null,t);n.length=0};if(!(n.length>1)){var s=function(e,t,n){for(var r,o=e.Config.paths,s=[],a=0;a<o.length;a++)r=o[a],f.UseLazyLoad?r.lazyBeforeStart?t&&t.push(r):r.lazyBeforeStop?n&&n.push(r):s.push(r):s.push(r);return s},a=0,c=function(e,n){if(e.IsInit)n();else{var r=s(e);i("Install "+e.Key+"...",r),f.Js(r,(function(){e.IsInit=!0,n()}),(function(n){i(n="初始化js库失败："+n,e),t(n)}))}},p=function(e,t){var n=[],r=[];s(e,n,r),e.ExtendDefault&&s(u,n,r);var o=e.LazyReady;o||(o=e.LazyReady={fsta:[],fsto:[],fall:[],usta:0,usto:0,msta:"",msto:""},e.LazyAtStart=function(e){a()?e(o.msta):o.fsta.push(e)},e.LazyAtStop=function(e){c()?e(o.msto):o.fsto.push(e)},e.OnLazyReady=function(e){a()&&c()?e(o.msta||o.msto):o.fall.push(e)});var a=function(){return 1==o.usta||3==o.usta},c=function(){return 1==o.usto||3==o.usto},l=t?"usta":"usto",d=t?"msta":"msto",R=t?"fsta":"fsto",S=function(n){n&&i("Lazy Load:"+l);var r=function(e,t){var n=o[e];o[e]=[];for(var r=0;r<n.length;r++)n[r](t)};2!=o[l]&&r(R,o[d]),a()&&c()&&r("fall",o.msta||o.msto),t&&p(e)};if(o[l]<2){o[d]="",o[l]=2;var y=t?n:r;i("Lazy Load..."+l,y),f.Js(y,(function(){o[l]=3,S(1)}),(function(t){i(t="加载js库失败["+l+"]："+t,e),o[l]=1,o[d]=t,S(1)}))}else S()},l=function(t){if(t)p(t,1),f.Current=t,i("Install Success"),e();else{var n=function(){t.Support((function(e){e?c(t,(function(){l(t)})):(a++,l())}))};(t=o[a]).ExtendDefault?c(u,n):n()}};l(f.Current)}},GetStartUsedRecOrNull:function(){return f.__Rec||null},GetStopUsedRec:function(){return f._SRec||null},RequestPermission:function(e,t){var n=function(e,n){i("录音权限请求失败："+e+",isUserNotAllow:"+(n=!!n),1),t&&t(e,n)};i("RequestPermission..."),f.Install((function(){var t=f.Current;i("开始请求录音权限"),t.RequestPermission((function(){i("录音权限请求成功"),e&&e()}),n)}),(function(e){n("Install失败："+e)}))},Start:function(e,t,n){var r=function(e){i("开始录音失败："+e,1),n&&n(e)};i("Start...");var o=f.Current;if(o){e||(e={});var s={type:"mp3",sampleRate:16e3,bitRate:16,onProcess:function(){}};for(var a in s)e[a]||(e[a]=s[a]);var u=Recorder(e).envCheck({envName:o.Key,canProcess:o.CanProcess()});if(u)r("不能录音："+u);else{f._SRec=0;var c=0;o.LazyAtStart((function(n){c&&i("Start Wait Ready "+(Date.now()-c)+"ms",3),c=1,n?r(n):o.Start(e,(function(){i("开始录音",e),t&&t()}),r)})),c||i("Start Wait Ready...",3),c=Date.now()}}else r("需先调用RequestPermission")},Stop:function(e,t){var n=function(e){i("结束录音失败："+e,1),f._SRec=0,t&&t(e)};i("Stop...");var r=Date.now(),o=f.Current;if(o){var s=0;o.LazyAtStop((function(t){s&&i("Stop Wait Ready "+(Date.now()-s)+"ms",3),s=1,t?n(t):o.Stop(e?function(t,n){i("结束录音 耗时"+(Date.now()-r)+"ms 音频"+n+"ms/"+t.size+"b"),e(t,n),f._SRec=0}:null,n)})),s||i("Stop Wait Ready...",3),s=Date.now()}else n("需先调用RequestPermission")}};e.RecordApp=f,i("【提醒】因为iOS 14.3+已无需本兼容方案即可实现H5录音，所以RecordApp正逐渐失去存在的意义；如果你不打算兼容老版本iOS，请直接使用简单强大的Recorder H5即可。",3),r&&r()}(window),"function"==typeof define&&define.amd&&define((function(){return RecordApp})),"object"==typeof module&&module.exports&&(module.exports=RecordApp);