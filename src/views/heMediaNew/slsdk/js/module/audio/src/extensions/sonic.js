!function(){"use strict";function t(r){var o=function(t){this.set=t;var r=function(t){var r,o,e,a,i=65,c=400,f=4e3,s=12,u=601,l=[0,0,0,0,0,0,0,-1,-1,-2,-2,-3,-4,-6,-7,-9,-10,-12,-14,-17,-19,-21,-24,-26,-29,-32,-34,-37,-40,-42,-44,-47,-48,-50,-51,-52,-53,-53,-53,-52,-50,-48,-46,-43,-39,-34,-29,-22,-16,-8,0,9,19,29,41,53,65,79,92,107,121,137,152,168,184,200,215,231,247,262,276,291,304,317,328,339,348,357,363,369,372,374,375,373,369,363,355,345,332,318,300,281,259,234,208,178,147,113,77,39,0,-41,-85,-130,-177,-225,-274,-324,-375,-426,-478,-530,-581,-632,-682,-731,-779,-825,-870,-912,-951,-989,-1023,-1053,-1080,-1104,-1123,-1138,-1149,-1154,-1155,-1151,-1141,-1125,-1105,-1078,-1046,-1007,-963,-913,-857,-796,-728,-655,-576,-492,-403,-309,-210,-107,0,111,225,342,462,584,708,833,958,1084,1209,1333,1455,1575,1693,1807,1916,2022,2122,2216,2304,2384,2457,2522,2579,2625,2663,2689,2706,2711,2705,2687,2657,2614,2559,2491,2411,2317,2211,2092,1960,1815,1658,1489,1308,1115,912,698,474,241,0,-249,-506,-769,-1037,-1310,-1586,-1864,-2144,-2424,-2703,-2980,-3254,-3523,-3787,-4043,-4291,-4529,-4757,-4972,-5174,-5360,-5531,-5685,-5819,-5935,-6029,-6101,-6150,-6175,-6175,-6149,-6096,-6015,-5905,-5767,-5599,-5401,-5172,-4912,-4621,-4298,-3944,-3558,-3141,-2693,-2214,-1705,-1166,-597,0,625,1277,1955,2658,3386,4135,4906,5697,6506,7332,8173,9027,9893,10769,11654,12544,13439,14335,15232,16128,17019,17904,18782,19649,20504,21345,22170,22977,23763,24527,25268,25982,26669,27327,27953,28547,29107,29632,30119,30569,30979,31349,31678,31964,32208,32408,32565,32677,32744,32767,32744,32677,32565,32408,32208,31964,31678,31349,30979,30569,30119,29632,29107,28547,27953,27327,26669,25982,25268,24527,23763,22977,22170,21345,20504,19649,18782,17904,17019,16128,15232,14335,13439,12544,11654,10769,9893,9027,8173,7332,6506,5697,4906,4135,3386,2658,1955,1277,625,0,-597,-1166,-1705,-2214,-2693,-3141,-3558,-3944,-4298,-4621,-4912,-5172,-5401,-5599,-5767,-5905,-6015,-6096,-6149,-6175,-6175,-6150,-6101,-6029,-5935,-5819,-5685,-5531,-5360,-5174,-4972,-4757,-4529,-4291,-4043,-3787,-3523,-3254,-2980,-2703,-2424,-2144,-1864,-1586,-1310,-1037,-769,-506,-249,0,241,474,698,912,1115,1308,1489,1658,1815,1960,2092,2211,2317,2411,2491,2559,2614,2657,2687,2705,2711,2706,2689,2663,2625,2579,2522,2457,2384,2304,2216,2122,2022,1916,1807,1693,1575,1455,1333,1209,1084,958,833,708,584,462,342,225,111,0,-107,-210,-309,-403,-492,-576,-655,-728,-796,-857,-913,-963,-1007,-1046,-1078,-1105,-1125,-1141,-1151,-1155,-1154,-1149,-1138,-1123,-1104,-1080,-1053,-1023,-989,-951,-912,-870,-825,-779,-731,-682,-632,-581,-530,-478,-426,-375,-324,-274,-225,-177,-130,-85,-41,0,39,77,113,147,178,208,234,259,281,300,318,332,345,355,363,369,373,375,374,372,369,363,357,348,339,328,317,304,291,276,262,247,231,215,200,184,168,152,137,121,107,92,79,65,53,41,29,19,9,0,-8,-16,-22,-29,-34,-39,-43,-46,-48,-50,-52,-53,-53,-53,-52,-51,-50,-48,-47,-44,-42,-40,-37,-34,-32,-29,-26,-24,-21,-19,-17,-14,-12,-10,-9,-7,-6,-4,-3,-2,-2,-1,-1,0,0,0,0,0,0,0],h=0,v=0,d=0,w=0,p=0,m=0,M=!1,y=0,k=0,b=0,R=0,S=0,g=0,A=0,j=0,I=0,O=0,x=0,L=0,U=0,_=0,P=0,F=0,T=0;function W(t,r){r*=k;var o=new Int16Array(r),e=t.length<=r?t.length:r;return n.arraycopy(t,0,o,0,e),o}function B(t,r,o,e,a){n.arraycopy(o,e*k,t,r*k,a*k)}function C(t,r,o,n){for(var e=Math.floor(4096*n),a=r*k,i=a+o*k,c=a;c<i;c++){var f=t[c]*e>>12;f>32767?f=32767:f<-32767&&(f=-32767),t[c]=f}}function D(t){h=t}function N(t){d=t}function Q(t){w!=t&&(w=t,p=0,m=0)}function V(t){M=t}function E(t){y=t}function q(t){v=t}function z(t,n){I=Math.floor(t/c),O=Math.floor(t/i),b=x=2*O,r=new Int16Array(x*n),S=x,o=new Int16Array(x*n),R=x,e=new Int16Array(x*n),a=new Int16Array(x),U=t,k=n,p=0,m=0,_=0}function G(t,r){z(t,r),h=1,d=1,v=1,w=1,p=0,m=0,M=!1,y=0}function H(t){A+t>S&&(o=W(o,S+=(S>>1)+t))}function J(t){g+t>b&&(r=W(r,b+=(b>>1)+t))}function K(t,o){0!=o&&(J(o),B(r,g,t,0,o),g+=o)}function X(t){var o=g-t;B(r,0,r,t,o),g=o}function Y(t,r,n){H(n),B(o,A,t,r,n),A+=n}function Z(t){var o=L;return o>x&&(o=x),Y(r,t,o),L-=o,o}function $(){var t=A,r=new Int16Array(t),n=0;return 0==t||(B(r,0,o,0,t),B(o,0,o,t,n),A=n),r}function tt(){var t=g,o=h/d,n=w*d,e=Math.floor(A+Math.floor((t/o+j)/n+.5));J(t+2*x);for(var a=0;a<2*x*k;a++)r[t*k+a]=0;g+=2*x,Mt(null,0),A>e&&(A=e),g=0,L=0,j=0}function rt(t,r,o){var n,e=Math.floor(x/o),i=k*o;r*=k;for(var c=0;c<e;c++){n=0;for(var f=0;f<i;f++)n+=t[r+c*i+f];n=Math.floor(n/i),a[c]=n}}function ot(t,r,o,n){var e=0,a=255,i=1,c=0;r*=k;for(var f=o;f<=n;f++){for(var s=0,u=0;u<f;u++){var l=t[r+u],h=t[r+f+u];s+=l>=h?l-h:h-l}s*e<i*f&&(i=s,e=f),s*a>c*f&&(c=s,a=f)}return F=Math.floor(i/e),T=Math.floor(c/a),e}function nt(t,r,o){if(0==t||0==_)return!1;if(o){if(r>3*t)return!1;if(2*t<=3*P)return!1}else if(t<=P)return!1;return!0}function et(t,r,o){var n,e,i=1;if(U>f&&0==y&&(i=Math.floor(U/f)),1==k&&1==i)n=ot(t,r,I,O);else if(rt(t,r,i),n=ot(a,0,Math.floor(I/i),Math.floor(O/i)),1!=i){var c=(n*=i)-(i<<2),s=n+(i<<2);c<I&&(c=I),s>O&&(s=O),1==k?n=ot(t,r,c,s):(rt(t,r,1),n=ot(a,0,c,s))}return e=nt(F,T,o)?_:n,P=F,_=n,e}function at(t,r,o,n,e,a,i,c){for(var f=0;f<r;f++)for(var s=n*r+f,u=c*r+f,l=a*r+f,h=0;h<t;h++)o[s]=Math.floor((e[l]*(t-h)+i[u]*h)/t),s+=r,l+=r,u+=r}function it(t,r,o,n,e,a,i,c,f){for(var s=0;s<r;s++)for(var u=e*r+s,l=f*r+s,h=i*r+s,v=0;v<t+o;v++)v<o?(n[u]=Math.floor(a[h]*(t-v)/t),h+=r):v<t?(n[u]=Math.floor((a[h]*(t-v)+c[l]*(v-o))/t),h+=r,l+=r):(n[u]=Math.floor(c[l]*(v-o)/t),l+=r),u+=r}function ct(t){var r=A-t;j+r>R&&(e=W(e,R+=(R>>1)+r)),B(e,j,o,t,r),A=t,j+=r}function ft(t){0!=t&&(B(e,0,e,t,j-t),j-=t)}function st(t){var r,n,a=0;if(A!=t){for(ct(t);j-a>=x;)r=et(e,a,!1),H(n=Math.floor(r/d)),d>=1?at(n,k,o,A,e,a,e,a+r-n):it(r,k,n-r,o,A,e,a,e,a),A+=n,a+=r;ft(a)}}function ut(t,r,o){var n=Math.floor((u-1)/s),e=Math.floor(t*n+r*n/o),a=e+1,i=t*n*o+r*n-e*o,c=l[e],f=l[a];return Math.floor((c*(o-i)+f*i<<1)/o)}function lt(t){return t>=0?1:-1}function ht(t,r,o,n){var e,a,i,c,f=0,u=(p+1)*n,l=u-m*o-1,h=u-p*n,v=0;for(e=0;e<s;e++)a=ut(e,l,h),i=t[r+e*k]*a,(c=lt(f))!=lt(f+=i)&&lt(i)==c&&(v+=c);return v>0?32767:v<0?-32768:f>>16&65535}function vt(t,r){for(var n,a=Math.floor(U/t),i=U;a>16384||i>16384;)a>>=1,i>>=1;if(A!=r){for(ct(r),n=0;n<j-1;n++){for(;(p+1)*a>m*i;){H(1);for(var c=0;c<k;c++)o[A*k+c]=ht(e,n*k+c,i,a);m++,A++}if(++p==i){if(p=0,m!=a)throw new Error("Assertion failed: newRatePosition != newSampleRate\n");m=0}}ft(n)}}function dt(t,r,n,e){var a;return n>=2?a=Math.floor(e/(n-1)):(a=e,L=Math.floor(e*(2-n)/(n-1))),H(a),at(a,k,o,A,t,r,t,r+e),A+=a,a}function wt(t,r,n,e){var a;return n<.5?a=Math.floor(e*n/(1-n)):(a=e,L=Math.floor(e*(2*n-1)/(1-n))),H(e+a),B(o,A,t,r,e),at(a,k,o,A+e,t,r+e,t,r),A+=e+a,a}function pt(t){var o,n=g,e=0;if(!(g<x)){do{L>0?e+=Z(e):(o=et(r,e,!0),e+=t>1?o+dt(r,e,t,o):wt(r,e,t,o))}while(e+x<=n);X(e)}}function mt(){var t=A,n=h/d,e=w;M||(e*=d),n>1.00001||n<.99999?pt(n):(Y(r,0,g),g=0),M?1!=d&&st(t):1!=e&&vt(e,t),1!=v&&C(o,t,A-t,v)}function Mt(t){K(t,t?t.length:0),mt()}return t.setPitch=N,t.setRate=Q,t.setSpeed=D,t.setVolume=q,t.setChordPitch=V,t.setQuality=E,{New:G,flushStream:tt,writeShortToStream:Mt,readShortFromStream:$}}(this);this.sonic=r,r.New(t.sampleRate,1)};o.prototype=t.prototype={input:function(t){return this.sonic.writeShortToStream(t),this.sonic.readShortFromStream()},flush:function(){return this.sonic.flushStream(),this.sonic.readShortFromStream()}};var n={arraycopy:function(t,r,o,n,e){for(var a=0;a<e;a++)o[n+a]=t[r+a]}};return new o(r)}var r;Recorder.Sonic=t,Recorder.BindDestroy("sonicWorker",(function(){console.log("sonicWorker Destroy"),r&&r.terminate(),r=null}));var o={id:0};t.Async=function(t){var e=r;try{if(!e){var a=");var wk_ctxs={};self.onmessage="+function(t){var r=t.data,o=wk_ctxs[r.id];if("init"==r.action)wk_ctxs[r.id]={sampleRate:r.sampleRate,sonicObj:wk_sonic({sampleRate:r.sampleRate})};else if(!o)return;switch(r.action){case"flush":var n=o.sonicObj.flush();self.postMessage({action:r.action,id:r.id,call:r.call,pcm:n}),o.sonicObj=null,delete wk_ctxs[r.id];break;case"input":n=o.sonicObj.input(r.pcm),self.postMessage({action:r.action,id:r.id,call:r.call,pcm:n});break;default:/^set/.test(r.action)&&o.sonicObj[r.action](r.param)}},i=Recorder.Sonic.toString(),c=(window.URL||webkitURL).createObjectURL(new Blob(["var wk_sonic=(",i,a],{type:"text/javascript"}));e=new Worker(c),setTimeout((function(){(window.URL||webkitURL).revokeObjectURL(c)}),1e4),e.onmessage=function(t){var r=o[t.data.id];if(r){var n=r.cbs[t.data.call];n&&n(t.data)}}}var f=new n(e,t);return f.id=++o.id,o[f.id]=f,e.postMessage({action:"init",id:f.id,sampleRate:t.sampleRate,x:new Int16Array(5)}),r=e,f}catch(t){return e&&e.terminate(),console.error(t),null}};var n=function(t,r){this.worker=t,this.set=r,this.cbs={i:0}};n.prototype={cb:function(t){var r=this,o="cb"+ ++r.cbs.i;return r.cbs[o]=function(n){delete r.cbs[o],t(n)},o},flush:function(t){var r=this;r.worker&&r.worker.postMessage({action:"flush",id:r.id,call:r.cb((function(n){t&&t(n.pcm),r.worker=null,delete o[r.id];var e=-1;for(var a in o)e++;e&&console.warn("sonic worker剩"+e+"个在串行等待")}))})},input:function(t,r){var o=this;o.worker&&o.worker.postMessage({action:"input",id:o.id,pcm:t,call:o.cb((function(t){r&&r(t.pcm)}))})}};var e=function(t){n.prototype[t]=function(r){var o=this;o.worker&&o.worker.postMessage({action:t,id:o.id,param:r})}};e("setPitch"),e("setRate"),e("setSpeed"),e("setVolume"),e("setChordPitch"),e("setQuality")}();