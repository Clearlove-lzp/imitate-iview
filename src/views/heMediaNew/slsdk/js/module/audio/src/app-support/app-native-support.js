!function(){"use strict";var e=RecordApp,t=e.CLog,a=e.Platforms.Native,r=a.Config;a.IsInit=!0;var n=window.NativeRecordReceivePCM=function(e,r){var i=n.rec;if(i){i._appStart||i.envStart({envName:a.Key,canProcess:a.CanProcess()},r),i._appStart=1;for(var c,o=atob(e),s=o.length,v=new Int16Array(s/2),d=0,f=0,u=0;u+2<=s;f++,u+=2)c=(o.charCodeAt(u)|o.charCodeAt(u+1)<<8)<<16>>16,v[f]=c,d+=Math.abs(c);i.envIn(v,d)}else t("未开始录音，但收到Native PCM数据",3)};try{window.top.NativeRecordReceivePCM=n}catch(e){var i=function(){t("检测到跨域iframe，NativeRecordReceivePCM无法注入到顶层，已监听postMessage转发兼容传输数据，请自行实现将top层接收到数据转发到本iframe（不限层），不然无法接收到录音数据",3)};setTimeout(i,8e3),i(),addEventListener("message",(function(e){var t=e.data;t&&"NativeRecordReceivePCM"==t.type&&(t=t.data,n(t.pcmDataBase64,t.sampleRate))}))}a.RequestPermission=function(e,t){r.JsBridgeRequestPermission(e,t)},a.Start=function(t,a,i){n.param=t;var c=Recorder(t);c.set.disableEnvInFix=!0,n.rec=c,e.__Rec=c,r.JsBridgeStart(t,a,i)},a.Stop=function(a,i){var c=function(t){i("录音失败[Native]："+t),n.rec=null,e.__Rec=null};r.JsBridgeStop((function(){var r=n.rec;if(n.rec=null,r){t("rec encode start: pcm:"+r.recSize+" src:"+r.srcSampleRate+" set:"+JSON.stringify(n.param));var i=function(){for(var e in r.set)n.param[e]=r.set[e]};if(!a)return i(),void c("仅清理资源");r.stop((function(n,c){t("rec encode end"),i(),e._SRec=r,a(n,c),e.__Rec=null}),(function(e){i(),c(e)}))}else c("未开始录音")}),c)}}();