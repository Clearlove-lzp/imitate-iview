!function(){"use strict";Recorder.DTMF_Decode=function(t,a,s){s||(s={});var l=s.lastIs||"",n=null==s.lastCheckCount?99:s.lastCheckCount,c=s.prevIs||"",h=s.totalLen||0,u=s.pcm,d=s.checkFactor||0,v=s.debug,f=[];if(!Recorder.LibFFT)throw new Error("需要lib.fft.js支持");var g=256,i=Recorder.LibFFT(g),b=d||3,k=h,F=a/4e3,p=Math.floor(t.length/F);h+=p;var M=0;u&&u.length>g&&(p+=M=64*(b+1),k-=M);var y=new Int16Array(p);M&&y.set(u.subarray(u.length-M));for(var C=0;C<t.length;M++,C+=F)y[M]=t[Math.round(C)];t=y;for(var m=(a=4e3)/g,I=0;I+g<=t.length;I+=64){y=t.subarray(I,I+g);for(var w=i.transform(y),L=[],x=0,D=0,R=0,T=0,A=0,j=0,B=0,E=0,_=0;_<w.length;_++){var q=w[_],z=Math.log(q);L.push(z);var G=(_+1)*m;z>20&&(q>x&&G<1050?(x=q,D=z,R=G,T=_):q>A&&G>1050&&(A=q,j=z,B=G,E=_))}var H=-1,J=-1;if(R>600&&B<1700&&Math.abs(D-j)<2.5){var K=1,N=D,O=0;for(_=T;_<E;_++){(G=L[_])&&G<N&&(N=G,O=_)}var P=.5*(D-N),Q=D;for(_=T;K&&_<O;_++){(G=L[_])<=Q?Q=G:G-Q>P&&(K=0)}var S=N;for(_=O;K&&_<E;_++){(G=L[_])>=S?S=G:S-G>P&&(K=0)}K&&(H=o(R,r[0],m),J=o(B,r[1],m))}var U="";H>=0&&J>=0?(U=e[H][J],v&&console.log(U,Math.round((k+I)/a*1e3),D.toFixed(2),j.toFixed(2),Math.abs(D-j).toFixed(2)),l?l.key==U?n++:(U="",n=l.old+n):(c&&c.old2&&c.key==U&&k+I-c.start<100*a/1e3&&(l=c,n=c.old2+1,v&&console.warn("接续了开叉的信号"+n)),l||(n>=3?(l={key:U,old:n,old2:n,start:k+I,pcms:[],use:0},n=1):(U="",n=0)))):l&&(l.old2=n,n=l.old+n),U?(v&&l.pcms.push(y),n>=b&&!l.use&&(l.use=1,f.push({key:U,time:Math.round(l.start/a*1e3)})),l.use&&(v&&console.log(U+"有效按键",l),l.old=0,l.old2=0,n=0)):(l&&(v&&console.log(l),c=l),l="",n++)}return{keys:f,lastIs:l,lastCheckCount:n,prevIs:c,totalLen:h,pcm:t,checkFactor:d,debug:v}};var r=[[697,770,852,941],[1209,1336,1477,1633]],e=[["1","2","3","A"],["4","5","6","B"],["7","8","9","C"],["*","0","#","D"]],o=function(r,e,o){for(var t=-1,a=1e3,s=0;s<e.length;s++){var l=Math.abs(e[s]-r);a>l&&(a=l,l<2*o&&(t=s))}return t}}();