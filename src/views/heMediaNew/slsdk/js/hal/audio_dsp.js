var media_stream,audio_ctx,media_source=null,audio_process=null,record_pcm_cb=null,play_pcm_cb=null;import{convertFloat32ToInt16,convertInt16ToFloat32}from"../common/helper.js";export function AudioDspInit(){navigator.mediaDevices.getUserMedia({audio:!0}).then((o=>{audio_ctx=new(window.AudioContext||window.webkitAudioContext)({sampleRate:8e3}),media_stream=o}))}export function AudioDspStart(){media_source=audio_ctx.createMediaStreamSource(media_stream),null!=(audio_process=audio_ctx.createScriptProcessor(512,1,1))?null!=media_source?(audio_process.onaudioprocess=function(o){if(record_pcm_cb){var e=o.inputBuffer.getChannelData(0),c=convertFloat32ToInt16(e);record_pcm_cb(c)}if(play_pcm_cb){e=o.outputBuffer.getChannelData(0),c=play_pcm_cb(512);var t=convertInt16ToFloat32(c);e.set(t)}},media_source.connect(audio_process),audio_process.connect(audio_ctx.destination)):console.log("media_source error!!"):console.log("audio_process error!!")}export function AudioDspStop(){audio_process?(audio_process.disconnect(),audio_process=null):console.log("not find audio_process"),media_source?(media_source.disconnect(),media_source=null):console.log("not find media_source")}export function AudioDspStartRecord(o){record_pcm_cb=o,null==play_pcm_cb&&AudioDspStart()}export function AudioDspStopRecord(){record_pcm_cb=null,null==play_pcm_cb&&AudioDspStop()}export function AudioDspStartPlay(o){play_pcm_cb=o,null==record_pcm_cb&&AudioDspStart()}export function AudioDspStopPlay(){play_pcm_cb=null,null==record_pcm_cb&&AudioDspStop()}AudioDspInit();